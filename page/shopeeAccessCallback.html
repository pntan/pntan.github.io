<script type="module">
	async function getUrlServer(){
		var time = Date.now();
		// Thêm timestamp để tránh cache của GitHub Pages
		const url = `https://pntan.github.io/chuanmuangrok.json?timestamp=${time}`;

		try {
			const response = await fetch(url, { cache: "no-store" });
			if (!response.ok) throw new Error('Network response was not ok');
			const data = await response.json();
			return data.url; // Ví dụ: "https://abcd-123.ngrok-free.app"
		} catch (error) {
			console.error('Lỗi khi fetch URL từ GitHub:', error);
			return null;
		}
	}

	getUrlServer().then(url_server => {
		if (url_server) {
			// Lấy toàn bộ query string hiện tại (?code=...&shop_id=...&state=...)
			const currentSearch = window.location.search;
            
            // Log để debug (có thể xóa sau này)
			console.log("Redirecting to:", `${url_server}/callback/shopee/accessTokenCallback${currentSearch}`);

			// Redirect về Ngrok server kèm theo nguyên bộ query string
			window.location.href = `${url_server}/callback/shopee/accessTokenCallback${currentSearch}`;
		} else {
            document.body.innerHTML = "<h1>Không tìm thấy Server! Vui lòng liên hệ Admin.</h1>";
        }
	});
</script>



